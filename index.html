<!DOCTYPE html>
<html>
<head>
	<title>分页展示示例</title>
	<meta charset="UTF-8">
	<style>
		.table {
			width: 100%;
			border-collapse: collapse;
			font-size: 0; /* 去除空白间距 */
		}
		.table th {
			padding: 10px;
			background-color: #eee;
			text-align: left;
		}
		.table td {
			padding: 10px;
			text-align: center;
		}
		.item-container {
			display: inline-block;
			width: 100px;
			height: 120px;
			margin: 10px;
			text-align: center;
		}
		.item-container img {
			width: 80px;
			height: 80px;
			margin-bottom: 10px;
		}
		.item-container div {
			font-size: 14px;
			font-weight: bold;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		.pagination {
			margin-top: 20px;
			text-align: center;
		}
	</style>
</head>
<body>
	<h1>分页展示示例</h1>
	<input type="text" id="searchInput" placeholder="搜索...">
	<button id="searchButton">搜索</button>
	<div id="tableContainer"></div>

	<script>
		// 读取数据文件
		fetch('data.txt')
			.then(response => response.text())
			.then(data => {
				// 将数据解析为对象数组
				const items = data.trim().split('\n').map(line => {
					const [id, name, type, msg] = line.replace(/[{}]/g, '').split(',');
					return { id, name, type, msg };
				});

				// 设置每页显示的数量
				const pageSize = 1000;

				// 初始化分页和搜索
				let currentPage = 1;
				let filteredItems = items;
				const tableContainer = document.getElementById('tableContainer');
				const searchInput = document.getElementById('searchInput');
				const searchButton = document.getElementById('searchButton');
				renderTable();

				// 渲染表格
				function renderTable() {
					// 清空容器
					tableContainer.innerHTML = '';

					// 创建表格元素
					const table = document.createElement('table');
					table.classList.add('table');

					// 创建表头
					const thead = document.createElement('thead');
					const tr = document.createElement('tr');
					const th = document.createElement('th');
					th.textContent = `第 ${currentPage} 页`;
					tr.appendChild(th);
					thead.appendChild(tr);
					table.appendChild(thead);

					// 创建表格内容
					let tbody = document.createElement('tbody');
					const startIndex = (currentPage - 1) * pageSize;
					const endIndex = Math.min(startIndex + pageSize, filteredItems.length);
					for (let i = startIndex; i < endIndex; i++) {
						const item = filteredItems[i];
						const td = document.createElement('td');
						const itemContainer = document.createElement('div');
						itemContainer.classList.add('item-container');
						const img = document.createElement('img');
						img.src = `ico/${item.id}.png`;
						const name = document.createElement('div');
						name.textContent = item.name;
						itemContainer.appendChild(img);
						itemContainer.appendChild(name);
						td.appendChild(itemContainer);
						td.addEventListener('click', () => {
							alert(`ID: ${item.id}\nType: ${item.type}\nMessage: ${item.msg}`);
						});
						tbody.appendChild(td);
						if ((i + 1) % 10 === 0) {
							const tr = document.createElement('tr');
							tr.appendChild(tbody);
							table.appendChild(tr);
							tbody = document.createElement('tbody');
						}
					}
					table.appendChild(tbody);

					// 创建分页控件
					const pagination = document.createElement('div');
					pagination.classList.add('pagination');
					if (currentPage > 1) {
						const prevButton = document.createElement('button');
						prevButton.textContent = '上一页';
						prevButton.addEventListener('click', () => {
							currentPage--;
							renderTable();
						});
						pagination.appendChild(prevButton);
					}
					if (currentPage < totalPages()) {
						const nextButton = document.createElement('button');
						nextButton.textContent = '下一页';
						nextButton.addEventListener('click', () => {
							currentPage++;
							renderTable();
						});
						pagination.appendChild(nextButton);
					}
					tableContainer.appendChild(table);
					tableContainer.appendChild(pagination);
				}

				// 计算总页数
				function totalPages() {
					return Math.ceil(filteredItems.length / pageSize);
				}

				// 分类功能
				const types = Array.from(new Set(items.map(item => item.type))); // 获取所有不重复的type
				const typeButtons = types.map(type => {
					const button = document.createElement('button');
					button.textContent = type;
					button.addEventListener('click', () => {
						filteredItems = items.filter(item => item.type === type);
						currentPage = 1;
						renderTable();
					});
					return button;
				});
				const typeContainer = document.createElement('div');
				typeContainer.appendChild(document.createTextNode('按类型筛选：'));
				typeButtons.forEach(button => typeContainer.appendChild(button));
				document.body.insertBefore(typeContainer, tableContainer);

				// 搜索功能
				searchButton.addEventListener('click', () => {
					const keyword = searchInput.value.trim().toLowerCase();
					if (keyword) {
						filteredItems = items.filter(item => item.id.includes(keyword) || item.name.toLowerCase().includes(keyword));
						if (filteredItems.length > 0) {
							currentPage = 1;
							renderTable();
						} else {
							alert('没有找到匹配项。');
						}
					} else {
						filteredItems = items;
						renderTable();
					}
				});
			})
			.catch(error => {
				console.error(error);
				alert('读取数据文件时发生错误。');
			});
	</script>
</body>
</html>
