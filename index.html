<!DOCTYPE html>
<html>
<head>
	<title>分页展示示例</title>
	<meta charset="UTF-8">
	<style>
		.table {
			width: 100%;
			border-collapse: collapse;
			font-size: 0; /* 去除空白间距 */
		}
		.table th {
			padding: 10px;
			background-color: #eee;
			text-align: left;
		}
		.table td {
			padding: 10px;
			text-align: center;
		}
		.item-container {
			display: inline-block;
			width: 100px;
			height: 120px;
			margin: 10px;
			text-align: center;
		}
		.item-container img {
			width: 80px;
			height: 80px;
			margin-bottom: 10px;
		}
		.item-container div {
			font-size: 14px;
			font-weight: bold;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		.pagination {
			margin-top: 20px;
			text-align: left; /* 修改为左对齐 */
		}
		.page-info {
			font-size: 14px;
			font-weight: bold;
			margin-right: 10px;
		}
		.search-info { /* 新增样式 */
			font-size: 16px;
			font-weight: bold;
			margin-bottom: 10px;
		}
	</style>
</head>
<body>
	<h1>分页展示示例</h1>
	<div id="searchInfo"></div> <!-- 新增搜索信息显示区域 -->
	<input type="text" id="searchInput" placeholder="搜索...">
	<button id="searchButton">搜索</button>
	<div id="typeContainer"></div> <!-- 新增分类按钮显示区域 -->
	<div id="tableContainer"></div>
	<div id="paginationContainer"></div> <!-- 新增分页控件显示区域 -->

	<script>
		// 读取数据文件
		fetch('data.txt')
			.then(response => response.text())
			.then(data => {
				// 将数据解析为对象数组
				const items = data.trim().split('\n').map(line => {
					const [id, name, type, msg] = line.replace(/[{}]/g, '').split(',');
					return { id, name, type, msg };
				});

				// 设置每页显示的数量
				const pageSize = 1000;

				// 初始化分页和搜索
				let currentPage = 1;
				let filteredItems = items;
				const tableContainer = document.getElementById('tableContainer');
				const searchInput = document.getElementById('searchInput');
				const searchButton = document.getElementById('searchButton');
				const searchInfo = document.getElementById('searchInfo'); // 获取搜索信息显示区域
				const typeContainer = document.getElementById('typeContainer'); // 获取分类按钮显示区域
				const paginationContainer = document.getElementById('paginationContainer'); // 获取分页控件显示区域
				renderTable();

				// 渲染表格
				function renderTable() {
					// 清空容器
					tableContainer.innerHTML = '';

					// 创建表格元素
					const table = document.createElement('table');
					table.classList.add('table');

					// 创建表头
					const thead = document.createElement('thead');
					const tr = document.createElement('tr');
					const th = document.createElement('th');
					th.textContent = `第 ${currentPage} 页 / 共 ${totalPages()} 页`;
					tr.appendChild(th);
					thead.appendChild(tr);
					table.appendChild(thead);

					// 创建表格内容
					let tbody = document.createElement('tbody');
					const startIndex = (currentPage - 1) * pageSize;
					const endIndex = Math.min(startIndex + pageSize, filteredItems.length);
					for (let i = startIndex; i < endIndex; i++) {
						const item = filteredItems[i];
						const td = document.createElement('td');
						const itemContainer = document.createElement('div');
						itemContainer.classList.add('item-container');
						const img = document.createElement('img');
						img.src = `ico/${item.id}.png`;
						const name = document.createElement('div');
						name.textContent = item.name;
						const type = document.createElement('div'); // 新增type显示
						type.textContent = item.type;
						const msg = document.createElement('div'); // 新增msg显示
						msg.textContent = item.msg;
						itemContainer.appendChild(img);
						itemContainer.appendChild(name);
						itemContainer.appendChild(type); // 添加type显示
						itemContainer.appendChild(msg); // 添加msg显示
						td.appendChild(itemContainer);
						td.addEventListener('click', () => {
							alert(`ID: ${item.id}\nType: ${item.type}\nMessage: ${item.msg}`);
						});
						tbody.appendChild(td);
						if ((i + 1) % 10 === 0 || i === endIndex - 1) {
							const tr = document.createElement('tr');
							tr.appendChild(tbody);
							table.appendChild(tr);
							tbody = document.createElement('tbody');
						}
					}
					table.appendChild(tbody);

					// 创建分类按钮
					const types = Array.from(new Set(items.map(item => item.type))); // 获取所有不重复的type
					const typeButtons = types.map(type => {
						const button = document.createElement('button');
						button.textContent = type;
						button.addEventListener('click', () => {
							filteredItems = items.filter(item => item.type === type);
							currentPage = 1;
							renderTable();
							searchInfo.textContent = `类型：${type}`; // 修改搜索信息显示
						});
						return button;
					});
					typeContainer.innerHTML = ''; // 清空分类按钮显示区域
					typeContainer.appendChild(document.createTextNode('按类型筛选：'));
					typeButtons.forEach(button => typeContainer.appendChild(button));

					// 创建分页控件
					const pagination = document.createElement('div');
					pagination.classList.add('pagination');
					const pageInfo = document.createElement('span');
					pageInfo.classList.add('page-info');
					pageInfo.textContent = `第 ${currentPage} 页 / 共 ${totalPages()} 页`;
					pagination.appendChild(pageInfo);
					if (currentPage > 1) {
						const prevButton = document.createElement('button');
						prevButton.textContent = '上一页';
						prevButton.addEventListener('click', () => {
							currentPage--;
							renderTable();
						});
						pagination.appendChild(prevButton);
					}
					if (currentPage < totalPages()) {
						const nextButton = document.createElement('button');
						nextButton.textContent = '下一页';
						nextButton.addEventListener('click', () => {
							currentPage++;
							renderTable();
						});
						pagination.appendChild(nextButton);
					}
					paginationContainer.innerHTML = ''; // 清空分页控件显示区域
					paginationContainer.appendChild(pagination);
					paginationContainer.appendChild(typeContainer); // 将分类按钮移到分页控件上面
				}

				// 计算总页数
				function totalPages() {
					return Math.ceil(filteredItems.length / pageSize);
				}

				// 搜索功能
				searchButton.addEventListener('click', () => {
					const keyword = searchInput.value.trim().toLowerCase();
					if (keyword) {
						filteredItems = items.filter(item => item.id.includes(keyword) || item.name.toLowerCase().includes(keyword));
						if (filteredItems.length > 0) {
							currentPage = 1;
							renderTable();
							searchInfo.textContent = `搜索：${keyword}`; // 修改搜索信息显示
						} else {
							alert('没有找到匹配项。');
						}
					} else {
						filteredItems = items;
						renderTable();
						searchInfo.textContent = ''; // 清空搜索信息显示
					}
				});
			})
			.catch(error => {
				console.error(error);
				alert('读取数据文件时发生错误。');
			});
	</script>
</body>
</html>